{"version":3,"file":"index.js","sourceRoot":"","sources":["index.ts"],"names":[],"mappings":";AAAA;;GAEG;;AAEH,6CAAkC;AAmFzB,kBAnFF,qBAAO,CAmFE;AAlFhB,+BAA+B;AAC/B,6BAA6B;AAS7B,SAAgB,SAAS,CAAC,GAAY;IAErC,IAAI,IAAI,GAAG,qBAAO,CAAC,GAAG,CAAC,CAAC;IAExB,IAAI,CAAC,IAAI,EACT;QACC,MAAM,IAAI,UAAU,EAAE,CAAC;KACvB;IAED,IAAI,GAAG,GAAG,EAAE,CAAC,YAAY,CAAC,IAAI,CAAC,CAAC;IAEhC,OAAO,eAAe,CAAC,GAAG,CAAC,UAAU,CAAC,CAAC;AACxC,CAAC;AAZD,8BAYC;AAED,SAAgB,eAAe,CAAC,UAAoD;IAEnF,IAAI,EAAE,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;QACpC,QAAQ,EAAE,UAAU;KACpB,CAAA,CAAC,CAAC,UAAU,CAAC;IAEd,OAAO,EAAsB,CAAC;AAC/B,CAAC;AAPD,0CAOC;AAED,SAAgB,wBAAwB,CAAC,UAAoD;IAE5F,UAAU,GAAG,eAAe,CAAC,UAAU,CAAC,CAAC;IAEzC,OAAO,CAAC,UAAU,CAAC,QAAQ,IAAI,EAAE,CAAC;SAChC,MAAM,CAAC,UAAU,CAAC,EAAE,GAAG;QAEvB,IAAI,CAAC,GAAa,EAAE,CAAC;QAErB,IAAI,EAAE,GAAG,GAAG,CAAC,KAAK,CAAC,QAAQ,CAAC,CAAC;QAE7B,EAAE;aACA,KAAK,CAAC,UAAU,CAAC;YAEjB,IAAI,IAAI,GAAG,OAAO,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;YAE3B,IAAI,IAAI,EACR;gBACC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC;aACV;YAED,OAAO,IAAI,CAAC;QACb,CAAC,CAAC,CACF;QAED,IAAI,CAAC,CAAC,MAAM,EACZ;YACC,IAAI,CAAC,CAAC,MAAM,IAAI,EAAE,CAAC,MAAM,EACzB;gBACC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;aAC/B;iBAED;gBACC,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC;aAC/B;SACD;QAED,CAAC,CAAC,GAAG,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC;QAEhB,OAAO,CAAC,CAAC;IACV,CAAC,EAAE;QACF,MAAM,EAAE,EAAc;QACtB,MAAM,EAAE,EAAc;QAEtB,GAAG,EAAE,EAAc;KACnB,CAAC,CACF;AACF,CAAC;AA/CD,4DA+CC;AAID,kBAAe,SAAS,CAAA","sourcesContent":["/**\n * Created by user on 2018/5/14/014.\n */\n\nimport findPkg from 'find-pkg-ws';\nimport * as fs from 'fs-extra';\nimport * as path from 'path';\n\nexport type WorkspacesConfig = {\n\tpackages?: WorkspacesConfigArray,\n\tnohoist?: Array<string>,\n};\n\nexport type WorkspacesConfigArray = Array<string>;\n\nexport function getConfig(cwd?: string)\n{\n\tlet file = findPkg(cwd);\n\n\tif (!file)\n\t{\n\t\tthrow new RangeError();\n\t}\n\n\tlet pkg = fs.readJSONSync(file);\n\n\treturn parseWorkspaces(pkg.workspaces);\n}\n\nexport function parseWorkspaces(workspaces: WorkspacesConfig | WorkspacesConfigArray)\n{\n\tlet ws = Array.isArray(workspaces) ? {\n\t\tpackages: workspaces,\n\t}: workspaces;\n\n\treturn ws as WorkspacesConfig;\n}\n\nexport function parseStaticPackagesPaths(workspaces: WorkspacesConfig | WorkspacesConfigArray)\n{\n\tworkspaces = parseWorkspaces(workspaces);\n\n\treturn (workspaces.packages || [])\n\t\t.reduce(function (a, row)\n\t\t{\n\t\t\tlet b: string[] = [];\n\n\t\t\tlet ls = row.split(/[\\\\\\/]/);\n\n\t\t\tls\n\t\t\t\t.every(function (v)\n\t\t\t\t{\n\t\t\t\t\tlet bool = /^\\w+$/.test(v);\n\n\t\t\t\t\tif (bool)\n\t\t\t\t\t{\n\t\t\t\t\t\tb.push(v);\n\t\t\t\t\t}\n\n\t\t\t\t\treturn bool;\n\t\t\t\t})\n\t\t\t;\n\n\t\t\tif (b.length)\n\t\t\t{\n\t\t\t\tif (b.length != ls.length)\n\t\t\t\t{\n\t\t\t\t\ta.prefix.push(path.join(...b));\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ta.static.push(path.join(...b));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ta.all.push(row);\n\n\t\t\treturn a;\n\t\t}, {\n\t\t\tstatic: [] as string[],\n\t\t\tprefix: [] as string[],\n\n\t\t\tall: [] as string[],\n\t\t})\n\t;\n}\n\nexport { findPkg }\n\nexport default getConfig\n\n\n"]}